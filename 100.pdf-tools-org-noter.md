## Work with PDF files in Emacs with PDF-Tools and Org-noter (also with Ghostscript and DocView as a fallback)

**Note** In August 2020, while I was ~~writing this chapter~~ putting it on the side, a new version of Emacs was released: 27.1. Most of the settings of this chapter were done with using 26.3, but later finalized with 27.1. I do not believe this will materially change anything demonstrated here, but I thought I should make it explicit.

In this chapter, we will be looking at tools to let you work with PDF files within Emacs: namely, PDF-Tools, Org-noter, and ORB. The focus is how we can install them, and get them to work together. Once that’s done, you are good to start roaming on your own by using them, and learn more by reading their respective manuals, forums, etc.

The primary tool we will be at PDF-Tools. It lets you do more than read PDF files. You can highlight sentences, view highlights you have created in other tools (e.g. iPad), work with annotations, and [much more](https://github.com/politza/pdf-tools#features).

Org-noter uses many of the features of PDF-Tools[^3] to make it easy for you to take notes in Org Mode, while synchronise the notes and PDF article while you read and scroll the article. 

As Org-noter connects the PDF world and Org Mode world, we can look to use ORB to be the glue among your bibliography (`.bib` file), literature notes via Org-noter, and Org-roam for your Zettelkasten and digital garden. 

[^3]: PDF-Tools is not mandatory for using Org-noter; it is one of the tools it needs to work with for PDF (the other being DocView). PDF-Tools is recommended. Many of Org-noter’s powerful features rely on it; you can only use a subset of the features of Org-noter without it. PDF-Tools was originally developed to replace DocView with better features.

### Steps to install and configure PDF-Tools

I believe it is fair to say that many in the Windows community consider it a big challenge (near impossible) to install `PDF-Tools` and get it to work on Windows. I certainly thought so before trying it this time. To my surprise, it has turned out to be straightforward once you get it.

The key is:
1. Use [msys2](https://www.msys2.org/) as a build tool to compile necessary software pieces from sources

2. Do NOT follow the official Windows instruction to the letter on PDF-tools [GitHub page](https://github.com/politza/pdf-tools)[^1]

3. Instead of using "msys2 shell" (as instructed), build (compile) PDF-Tools from wihtin Emacs

[^1]: the official instruction will probably not work, and send you to rabbit holes of endless Googling, Cask and Python 2, which, it has turned out in the end, you don’t need (it did). 

Let me get straight to the steps you can follow. Overall, I would estimate that you need to set aside 45-60 minutes of your time. 

#### 1. Install MSYS2 

Go to Msys2 from its website at https://www.msys2.org/.

![MSYS2's website where you can donwload its installer .exe file](./images/2020-07-30_8-19-11.png)

Download the installer, execute it to install MSYS2. You can follow the rest of the instruction, but for PDF-Tools, you may not have to do much more than installing MSYS2. I did not even call `pacman Syu` to update the package database (I think it would be a good idea to do that so that you can get the latest verion of the packages).
    
![msys2 installation dialog](./images/2020-07-30_8-09-58.png)

#### 2. Install PDF-Tools in Emacs

Launch Emacs. Install `pdf-tools` from MELPA, or any other ways you use.

MSYS2 has its own Emacs in its package database, but you don't need to use it. The normal Emacs that you download from the GNU Emacs site, as in the previous chapters of this guide, works fine.

#### 3. Build (Compile) program files required by PDF-Tools

Don't worry, it's easy and automatic. Within Emacs, call `M-x pdf-tools-install RET` to start automatic build. Then wait.

If you Emacs prompt for an input, take the default option and say "yes" to the questions.

![Automatic build procss starts in Emacs](./images/2020-07-30_8-14-57.png)

This will automatically start to build (compile) software files (`.dll` and `.exe` files). It took me about 30 minutes; the duration will vary depending on how good your PC is. New files will appear in the `pdf-tools` sub-folder in your `~/.emacs.d/elpa` folder.

![Files generated by the auto build process](./images/2020-07-30_8-54-40.png)

Now you should be able to open PDF files with PDF-Tools. You can visit a PDF file like any other file via `C-x C-f`. Check that if have a PDF file handy.

![Open a PDF file](./images/2020-09-16_21-33-55.png)

#### 4. Add a one-line configuration in your `.emacs` config file

Add `(pdf-tools-install)` or `(pdf-loader-install)` in your config file, following the official instruction on PDF-Tools' [GitHub page](https://github.com/politza/pdf-tools#installing).

> To complete the installation process, you need to activate the package by puttign

```
(pdf-tools-install)
```

> somewhere in your .emacs. Alternatively, and if you care about start-up time, you may want to use

```
(pdf-loader-install)
```

This is it. You should be able to quit Emacs, launch it agian, and open a PDF file with PDF-Tools wihtin Emacs.

### Org-noter

Install [`org-noter`](https://github.com/weirdNox/org-noter) via MELPA, or any ways you use. This works without addtional configuration.

Usage is simple, and concisely described in the [GitHub documentation](https://github.com/weirdNox/org-noter#usage). You can either start an Org-noter session from an `.org` file, or from a PDF document.

... now for us, Org-roam users, an interesting challenge is set up Emacs where we can easily flow from a literature note written in `.org` (probably within your Org-roam directory) and Org-noter for a PDF document.

We will look at a flow that starts from Helm-bibtex to open a PDF file for a bibliographic entry, and then to opening a `.org` note as an Org-noter session. We will use ORB (Org-roam-bibtex).

The reason I think this flows more naturally than that starting from a PDF document is because of the Org-noter's logic below; I am not sure how this can be adjusted for Helm-bibtex and ORB.

```
- Creating the session from the document ---------------------------------------
This will try to find a notes file in any of the parent folders.
The names it will search for are defined in `org-noter-default-notes-file-names'.
It will also try to find a notes file with the same name as the
document, giving it the maximum priority.
When it doesn't find anything, it will interactively ask you what
you want it to do. The target notes file must be in a parent
folder (direct or otherwise) of the document.
```

## ORB with Org-noter

How to link with ORB? 
try this.
https://github.com/org-roam/org-roam-bibtex#org-noter-integration-orb-process-file-field-key
- `org-noter-notes-search-path`
- `org-noter-default-notes-file-names`

### Opening PDF in Helm-Bibtex Zotero 

```
;;; Open PDF file stored in Windows' standard Zotero storage
(setq bibtex-completion-pdf-field "File")
```

To open a PDF file stored via Zotero file in its standard place[^2], you need to set `helm-bibtex`'s variable `(setq bibtex-completion-pdf-field "File")`

[^2]: Alternatively, you should be able to use Zotfile to define your own folder where keep all the PDF files for your `.bib` file. Let me try and come back to this later.

### Do you need `pdf-tools` to work with PDF documents in Emacs?

No, you do not need PDF-Tools. 
For DocView to display a PDF document, you need `ghostscript` at a minimum. 

> PDF Tools is, among other things, a replacement of DocView for PDF files (https://github.com/politza/pdf-tools#about-this-package)


### Ghostscript -- fallback when PDF-Tools don't work for you
